<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>Slideshow</title>
  <style type="text/css">
    html, body {
      font-family: "Open Sans";
      font-size: 16px;
      width: 100vw;
      height: 100%;
      margin: 0px;
      overflow: hidden;
    }
    a {
      border-bottom: 1px dashed black;
      color: inherit;
      text-decoration: none;
    }
    a.no-bottom {
      border-bottom: 0px;
    }
    #loading-screen {
      background: white;
      width: 100%;
      height: 100%;
      z-index: 1000;
      display: block;
    }
    .flow {
      transition: opacity 0.2s linear 0s;
      display: none;
    }
    .slideshow-container {
      left: 0%;
      top: 0px;
      height: 100%;
      width: 100%;
    }
    .content-box {
      left: 0px;
      top: 0px;
      width: 1000px;
      height: 1000px;
    }
    .border-box {
      width: 100%;
      height: 100%;
      position: absolute;
      z-index: 100;      
    }
    #narration.content-box {
      height: calc(1000px - 3em);
      width: calc(1000px - 4em);
      padding: 1em;
      padding-left: 2em;
      padding-right: 2em;
      padding-bottom: 2em
    }
    .container-box {
      height: 1000px;
      width: 2000px;
      z-index: 50;
    }
    .landscape-illustration {
      position: absolute;
      width: calc(49%);
      height: 100%;
      left: 0px;
      top: 0px;
    }    
    .landscape-narration {
      position: absolute;
      width: calc(49%);
      height: 100%;
      left: calc(51%);
      top: 0px;
    }
    .landscape-illustration-reverse {
      position: absolute;
      width: calc(49%);
      height: 100%;
      left: calc(51%);
      top: 0px;
    }
    .landscape-narration-reverse {
      position: absolute;
      width: calc(49%);
      height: 100%;
      left: 0px;
      top: 0px;
    }    

    @media (orientation: portrait) {
      .container-box {
        height: 2000px;
        width: 1000px;
      }
      .portrait-illustration {
        position: absolute;
        width: 100%;
        height: calc(49%);
        top: 0px;
        left: 0px;
      }      
      .portrait-narration {
        position: absolute;
        top: calc(51%);
        left: 0px;
        width: 100%;
        height: calc(49%);
      }
    }

  </style>

  <div class="slideshow-container">
    <div class="container-box jj-scalable">
      <div class="border-box">
        <div class="landscape-illustration portrait-illustration" id="illustration-c">
          <div class="content-box" id="illustration">

<div id="first-flow" class="flow">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="1001px" height="1001px" viewBox="-0.5 -0.5 1001 1001" content="&lt;mxfile host=&quot;Electron&quot; modified=&quot;2020-12-01T21:37:56.356Z&quot; agent=&quot;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) draw.io/13.9.5 Chrome/85.0.4183.121 Electron/10.1.5 Safari/537.36&quot; etag=&quot;a0rH8kUNNOBK2EoPmdFs&quot; version=&quot;13.9.5&quot; type=&quot;device&quot;&gt;&lt;diagram id=&quot;SO_7Pwdn0zAmYjBRLb9S&quot; name=&quot;Page-1&quot;&gt;zZZBb9owFIB/TY6VjJ2k5rgy2kqDw8bWSbtUxn4h0Zw4cswS9uvnEBucwtROZd0CB/t775mXzw4QkVnZ3WlW50slQEYYiS4i7yOMJzHGUf9GYjcQShzY6EIMCB3BqvgJrtLTbSGgcWxARilpinoMuaoq4GbEmNaqHadlSooRqNkGRm30YMWZhJO0r4UwuaMYBen3UGxy/9Gpj5TMZzvQ5EyoNkBkHpGZVsoMo7KbgeztjcXc/iZ66ExDZV5SIL7co4er5TVfspouHtDHz9m3K7fKDya37o5ds2bnFWi1rQT0i6CI3LR5YWBVM95HW7vpluWmlHY2scPGaPUdZkoqbUmlKpt2kxVSPkGnzftOQBvoAuRu5g5UCUbvbEobbATyuvNwEw6Uue3fHKqPguzAOfoDX/h5X3YVezrheVesqYcjmxVd73fkKcIkS/rXiVQbSfdXX6EqE/DheqVeH8V0KHFPbjodpoF9fE1P5R/ga9yvbx/niw+LdNfSTyu8xU08ffeSs3o595QD5+fcr2kSJ+gyjhM0+c8cv+X5FgxodtZxyimsswudY/tAhI5jP/93kslbSk6AivicZIrXZP8lcgHJ8XTyRDL9e5Lt9PiruY8Ffz7I/Bc=&lt;/diagram&gt;&lt;/mxfile&gt;"><defs/><g><rect x="0" y="0" width="1000" height="1000" fill="none" stroke="none" pointer-events="all"/><ellipse cx="267" cy="208" rx="139" ry="139" fill="#f5f5f5" stroke="#666666" pointer-events="all"/><ellipse cx="640" cy="208" rx="139" ry="139" fill="#f8cecc" stroke="#b85450" pointer-events="all"/><ellipse cx="272" cy="572" rx="139" ry="139" fill="#dae8fc" stroke="#6c8ebf" pointer-events="all"/><ellipse cx="630" cy="577" rx="139" ry="139" fill="#d5e8d4" stroke="#82b366" pointer-events="all"/></g></svg>
</div>

<div id="second-flow" class="flow">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="1001px" height="1001px" viewBox="-0.5 -0.5 1001 1001" content="&lt;mxfile host=&quot;Electron&quot; modified=&quot;2020-12-01T17:17:26.370Z&quot; agent=&quot;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) draw.io/13.9.5 Chrome/85.0.4183.121 Electron/10.1.5 Safari/537.36&quot; etag=&quot;Sahvb0qJv7_8-kBhq5b6&quot; version=&quot;13.9.5&quot; type=&quot;device&quot;&gt;&lt;diagram id=&quot;SO_7Pwdn0zAmYjBRLb9S&quot; name=&quot;Page-1&quot;&gt;xZZdb5swFEB/DY+RjB2on5N1jdTmYcqWaX1z7EuwZjBynEH262eGIbikaqs2qsSDOfcaro8vHxFZFs2dYVW+1gJUhJFoIvIlwjieYxy1BxKnjlDiwd5I0SF0Bhv5F/zMnh6lgINnHbJaKyurEHJdlsBtwJgxug7TMq1EACq2h6CMFmw4UzBJ+ymFzT3FaJS+ArnP+1unfaRgfbYHh5wJXY8QuY3I0mhtu1HRLEG19kIxX5+JDpUZKO1rJogfK7SdrW/4mlX0YYu+fc8eZ/4qf5g6+hX7Yu2pV2D0sRTQXgRFZFHn0sKmYryN1m7THcttodxZ7IYHa/RvWGqljSOlLl3aIpNKPUHT4vtKwFhoRsgv5g50AdacXEo92gjU687HmzBQ5rd/P8w+C3ID7+gNvsjLvl4wxA5V16iZbFqr71Lho6lfrn/IiK9yJArTm6mnAb5Hkyudr6pfDznd7B639zO+uMevaau3aho3UYSJYEAzPuk4F0k5hV02iJ1YvOD6WbEJooHZuH99fZ5afH21CVAxv6SW4h1J049RG5NQ7TxOP1vtFR7uJ2ozyoFf7NodTeYJ+qCujXGgNiHx9dS60/M37H9s9CtAbv8B&lt;/diagram&gt;&lt;/mxfile&gt;"><defs/><g><rect x="0" y="0" width="1000" height="1000" fill="none" stroke="none" pointer-events="all"/><rect x="60" y="33" width="287" height="287" fill="#ffffff" stroke="#000000" pointer-events="all"/><rect x="508" y="132" width="287" height="287" fill="#dae8fc" stroke="#6c8ebf" pointer-events="all"/><rect x="138" y="416" width="287" height="287" fill="#d5e8d4" stroke="#82b366" pointer-events="all"/><rect x="512" y="531" width="287" height="287" fill="#f8cecc" stroke="#b85450" pointer-events="all"/></g></svg>
</div>


          </div>  
        </div>

        <div class="landscape-narration portrait-narration" id="narration-c">
          <div class="content-box" id="narration">
          </div>
        </div>
      </div>        
    </div>      
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.11.0/underscore-min.js" integrity="sha512-wBiNJt1JXeA/ra9F8K2jyO4Bnxr0dRPsy7JaMqSlxqTjUGHe1Z+Fm5HMjCWqkIYvp/oCbdJEivZ5pLvAtK0csQ==" crossorigin="anonymous"></script>  
  <script src="https://cdn.jsdelivr.net/gh/JakubNer/narrator-web-component/resources/public/js/narrator.js" crossorigin="anonymous"></script>
  <script>
    var delay = function(t) {
      return new Promise(resolve => setTimeout(resolve.bind(null), t));
    };
  </script>
  <script>
    /** ILLUSTRATOR DEFINITION **/

    /* Setup all narration animation events below: */
    kundel.narrator.register();
    illustration = {'narration': {...
      
{
  "min": "2em",
  "max": "2.5em",
  "svgPaneBackgroundColor": "#EEFFFF",
  "textPaneBackgroundColor": "#FFEEFF",
  "topBorder": "solid 1px",
  "bottomBorder": "solid 1px",
  "leftBorder": "solid 0px",
  "rightBorder": "solid 0px",
  "flipPanes": false,
  "sections": [
    {
      "flows": [
        {
          "html": "<b>Circles</b> show up (show all circles) ",
          "seconds": 2,
          "id": "first-flow__10"
        }
      ]
    },
    {
      "flows": [
        {
          "html": "Focus on red circle, then unfocus ",
          "seconds": 5,
          "id": "first-flow__20"
        }
      ],
      "subsections": [
        {
          "flows": [
            {
              "html": "Highlight blue circle ",
              "seconds": 2,
              "id": "first-flow__20-10"
            },
            {
              "html": "Also highlight green ",
              "seconds": 2,
              "id": "first-flow__20-20"
            },
            {
              "html": "Zoom in on the highlights, then they disappear ",
              "seconds": 3,
              "id": "first-flow__20-30"
            }
          ]
        },
        {
          "flows": [
            {
              "html": "Done, reset ",
              "seconds": 2,
              "id": "first-flow__20-40"
            }
          ]
        }
      ]
    },
    {
      "flows": [
        {
          "html": "transition to squares ",
          "seconds": 2,
          "id": "second-flow__10"
        }
      ]
    }
  ]
}

    , 'target': 'illustration'}};
  </script>
  <script>
    var annotateImageInDom = function(id) {
      var mappings = {
  "first-flow__10": {},
  "first-flow__20": {
    "focus": "<animate attributeName='viewBox' values='0 0 1000 1000;475 50 320 320;475 50 320 320;475 50 320 320;0 0 1000 1000' begin='.75s' dur='3.5s' fill='freeze' class='focus-anim'></animate>"
  },
  "first-flow__20-10": {
    "highlight": "<rect  x='115' y='415' width='310' height='300' stroke='#921930' stroke-width=2 rx=10 ry=10 fill-opacity=0 stroke-opacity=0><animate attributeName='stroke-opacity' values='.4' begin='.5s' dur='1.5s' fill='freeze' class='highlight-anim'/></rect>"
  },
  "first-flow__20-20": {
    "highlight": "<rect  x='115' y='415' width='300' height='300' stroke='#921930' stroke-width=2 rx=10 ry=10 fill-opacity=0 stroke-opacity=0><animate attributeName='stroke-opacity' values='.4' begin='0s' dur='2s' fill='freeze' class='highlight-anim'/></rect><rect  x='480' y='415' width='300' height='300' stroke='#921930' stroke-width=2 rx=10 ry=10 fill-opacity=0 stroke-opacity=0><animate attributeName='stroke-opacity' values='.4' begin='0s' dur='2s' fill='freeze' class='highlight-anim'/></rect>"
  },
  "first-flow__20-30": {
    "focus": "<animate attributeName='viewBox' values='0 0 1000 1000;115 411 678 329' begin='0s' dur='1s' fill='freeze' class='focus-anim'></animate>",
    "highlight": "<rect  x='115' y='415' width='300' height='300' stroke='#921930' stroke-width=2 rx=10 ry=10 fill-opacity=0 stroke-opacity=0><animate attributeName='stroke-opacity' values='.4;.4;0' begin='0s' dur='2s' fill='freeze' class='highlight-anim'/></rect><rect  x='480' y='415' width='300' height='300' stroke='#921930' stroke-width=2 rx=10 ry=10 fill-opacity=0 stroke-opacity=0><animate attributeName='stroke-opacity' values='.4;.4;0' begin='0s' dur='2s' fill='freeze' class='highlight-anim'/></rect>"
  },
  "first-flow__20-40": {
    "focus": "<animate attributeName='viewBox' values='115 411 678 329;115 411 678 329;115 411 678 329;0 0 1000 1000' begin='0s' dur='2s' fill='freeze' class='focus-anim'></animate>"
  },
  "second-flow__10": {
    "focus": "<animate attributeName='viewBox' values='500 500 0 0;0 0 1000 1000' begin='0s' dur='1.25s' fill='freeze' class='focus-anim'></animate>"
  }
};
      if (id in mappings) {
        var mapping = mappings[id];
        var svg = document.getElementById(id).children[0];
        if ("highlight" in mapping) {
          svg.insertAdjacentHTML( 'beforeend', mapping["highlight"]);
        }
        if ("focus" in mapping) {
          svg.insertAdjacentHTML( 'beforeend', mapping["focus"]);
        }        
      }
    }
  </script>
  <script>
    /** illustrator INITIALIZATION **/
    (function() {
      var value = illustration['narration'];
      var narrationPane = document.getElementById('narration');
      var illustrationPane = document.getElementById('illustration');

      narrationPane.addEventListener('timeline', function(e) {
        console.log("illustrator timeline (e.id: ", e.id, ")");
        if (e.id == 'PREVIOUS_BEFORE_FIRST') {
          console.log("at start");
          return;
        } else if (e.id == 'NEXT_AFTER_LAST') {
          console.log("at end");
          return;
        }

        var rootId = e.id.match(/^([-a-zA-Z0-9._]+)__.*$/);
        rootId = rootId[1];        

        _.each(document.getElementsByClassName('flow'), victim => {
          victim.style.opacity = 0;
        });
        _.each(document.getElementsByClassName('subflow'), victim => {
          victim.remove();
        });
        if (rootId != e.id) {
          var flow = document.getElementById(rootId);
          var subflow = flow.cloneNode(true);
          subflow.id = e.id;
          subflow.classList.add('subflow');
          illustrationPane.appendChild(subflow)
        }
        annotateImageInDom(e.id);
        var target = document.getElementById(e.id);
        if (target) {
          target.style.visibility = 'hidden';
          target.style.display = 'none';
          target.style.opacity = 1;
          _.each(target.childNodes, child => {
            if (child.nodeType == Node.ELEMENT_NODE) {
              child.style.webkitAnimation = 'none';
              child.style.animation = 'none';
            }
          });
        } else {
          console.log("WARNING! element from illustrator doesn't match any DIV ID: " + e.id);
        }
//        delay(200)
//          .then(() => {
            _.each(document.getElementsByClassName('flow'), victim => {
              victim.style.visibility = 'hidden';
              victim.style.display = 'none';
            });
            if (target) {
              target.style.visibility = 'visible';
              target.style.display = 'block';
              _.each(target.childNodes, child => {
                if (child.nodeType == Node.ELEMENT_NODE) {
                  child.style.webkitAnimation = '';
                  child.style.animation = '';
                }
              });
            }
          });
//      }, true);

      if (value.flipPanes && window.innerWidth > window.innerHeight) {
        var illustrationContainer = document.getElementById('illustration-c');
        var narrationContainer = document.getElementById('narration-c');
        illustrationContainer.classList.remove("landscape-illustration");
        illustrationContainer.classList.add("landscape-illustration-reverse");
        narrationContainer.classList.remove("landscape-narration");
        narrationContainer.classList.add("landscape-narration-reverse");
      }
      var css = `
        #illustration { background-color: ${value.svgPaneBackgroundColor ? value.svgPaneBackgroundColor : "#FFFFFF"}; }
        .narrator-section .narrator-subsection-frame { background-color: ${value.textPaneBackgroundColor ? value.textPaneBackgroundColor : "#FFFFFF"} !important; }
        .container-box { 
          background-color: ${value.textPaneBackgroundColor ? value.textPaneBackgroundColor : "#FFFFFF"}; 
        }
        .border-box {
          border-top: ${value.topBorder ? value.topBorder : "0px"}; 
          border-bottom: ${value.bottomBorder ? value.bottomBorder : "0px"}; 
          border-left: ${value.leftBorder ? value.leftBorder : "0px"}; 
          border-right: ${value.rightBorder ? value.rightBorder : "0px"}; 
        }
      `;
      head = document.head || document.getElementsByTagName('head')[0];
      style = document.createElement('style');
      head.appendChild(style);
      style.type = 'text/css';
      style.appendChild(document.createTextNode(css));

      narrationPane.setAttribute("sections", JSON.stringify(value.sections));
      narrationPane.setAttribute("paused", "true");
      narrationPane.setAttribute("font-size-min--section", value.min);
      narrationPane.setAttribute("font-size-max--section", value.max);
      narrationPane.setAttribute("next-hint", "press spacebar or arrow keys");
      kundel.narrator.created(narrationPane);
      kundel.narrator.goto_start(narrationPane);
    })();
  </script>  
  <script>
    var narrationPane = document.getElementById('narration');

    // progress forward through content
    var forward = function() {
      console.log('forward');
      kundel.narrator.goto_next(narrationPane);
    };
     // progress backward through content
    var backward = function() {
      console.log('backward');
      kundel.narrator.goto_previous(narrationPane);
    };

    /** KEYBOARD BINDINGS **/
    document.onkeydown = function(e) {
        switch (e.key) {
          case 'ArrowRight':
            forward();
            break;
          case 'ArrowLeft':
            backward();
            break;
          case 'ArrowUp':
            backward();
            break;
          case 'ArrowDown':
            forward();
            break;
          case ' ':
            forward();
            break;
        }
      }
  </script>
  <script>
    /** RESCALE & CENTER ALL jj-scalable DIVs **/

     // divs with .jj-scalable class can be designed using pixel offsets and absolute coordinates
     // these will scale to their container

     // these will be centered in their container
    var rescale_scalables = function() {
      var elements = document.getElementsByClassName("jj-scalable");
      _.each(elements, function(element) {
        var container = element.parentElement;
        var scale_height = container.offsetHeight / element.offsetHeight;
        var scale_width = container.offsetWidth / element.offsetWidth;
        var scale = Math.min(scale_height, scale_width);
        var translate_x = (-1 * ((element.offsetWidth - (element.offsetWidth * scale)) / 2)) / scale;
        var translate_y = (-1 * ((element.offsetHeight - (element.offsetHeight * scale)) / 2)) / scale;
        var inline_style = 'transform: scale(' + scale + ') translate(' + translate_x + 'px,' + translate_y + 'px);';
        inline_style = inline_style + ' -webkit-transform: scale(' + scale + ') translate(' + translate_x + 'px,' + translate_y + 'px);';
        inline_style = inline_style + ' -ms-transform: scale(' + scale + ') translate(' + translate_x + 'px,' + translate_y + 'px);';
        element.setAttribute('style', inline_style);
        var top = (container.offsetHeight - (scale * element.offsetHeight)) / 2;
        var left = (container.offsetWidth - (scale * element.offsetWidth)) / 2;
        top = (top > 0) ? top : 0;
        left = (left > 0) ? left : 0;
        element.style.top = top + 'px';
        element.style.left = left + 'px';
      });
    };
    window.onload = function() {
        rescale_scalables();
        setTimeout(rescale_scalables, 0);
      }
      /** WINDOW RESIZING **/
    window.addEventListener("resize", () => {
      rescale_scalables();
    });    
  </script>  
</body>

</html>